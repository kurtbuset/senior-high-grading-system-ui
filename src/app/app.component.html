<div class="app-container d-flex" [ngClass]="{ 'bg-light': account }">
  <nav
    *ngIf="account"
    class="navbar navbar-expand-lg navbar-dark"
    style="
      background-color: #004080;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1100;
      height: 70px;
    "
  >
    <div
      class="container-fluid d-flex align-items-center justify-content-between"
    >
      <!-- Logo Left -->
      <img
        src="../assets/images/bc logo.png"
        alt="bc logo"
        width="50"
        height="50"
        class="me-2"
      />

      <!-- Title Center -->
      <h4 class="text-white mb-0 fw-bold mx-auto text-center">
        Benedicto College
      </h4>

      <!-- ðŸ”” Notification Bell Right -->
      <ul class="navbar-nav">
        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle position-relative"
            href="#"
            id="notificationDropdown"
            role="button"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <span class="bi bi-bell"></span>
            <!-- Badge -->
            <span
              *ngIf="notifications.length > 0"
              class="badge badge-danger badge-pill position-absolute"
              style="top: 5px; right: 0; font-size: 0.7rem"
            >
              {{ notifications.length }}
            </span>
          </a>

          <!-- Dropdown Menu (inline fix: opens left) -->
          <div
            class="dropdown-menu"
            aria-labelledby="notificationDropdown"
            style="
              width: 300px;
              max-height: 400px;
              overflow-y: auto;
              right: 0;
              left: auto;
            "
          >
            <h6 class="dropdown-header">Notifications</h6>

            <ng-container *ngIf="notifications.length > 0; else noNotif">
              <a
                *ngFor="let notif of notifications"
                class="dropdown-item small"
                href="javascript:void(0)"
              >
                {{ notif.message }}
                <br />
                <small class="text-muted">{{
                  notif.date | date : "short"
                }}</small>
              </a>
            </ng-container>

            <!-- If no notifications -->
            <ng-template #noNotif>
              <span class="dropdown-item text-muted small"
                >No new notifications</span
              >
            </ng-template>
          </div>
        </li>
      </ul>
    </div>
  </nav>

  <!-- main nav -->
  <nav
    class="sidebar pt-5 vh-100"
    style="
      width: 200px;
      background-color: rgb(244, 244, 244);
      position: fixed;
      top: 70px;
      left: 0;
      height: calc(100vh - 70px);
      z-index: 1000;
      overflow-y: auto;
      border-right: 1px solid #ddd;
    "
    *ngIf="account"
  >
    <div class="px-3 pb-3 border-bottom text-center">
      <i class="bi bi-person-circle text-primary" style="font-size: 2rem"></i>
      <div class="fw-bold mt-2">
        {{ account.firstName }} {{ account.lastName }}
      </div>
      <div class="text-muted" style="font-size: 0.9rem">
        {{ account.role }}
      </div>
    </div>

    <ul class="nav flex-column">
      <li class="nav-item border-bottom">
        <a
          routerLink="/"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: true }"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-speedometer2 me-2 text-primary"></i> Dashboard
        </a>
      </li>

      <li
        *ngIf="account.role === Role.SuperAdmin"
        class="nav-item border-bottom"
      >
        <a
          routerLink="/admin/accounts"
          routerLinkActive="active"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-people me-2 text-primary"></i> Accounts
        </a>
      </li>

      <li class="nav-item border-bottom" *ngIf="account.role === Role.Teacher">
        <a
          routerLink="/teacher"
          routerLinkActive="active"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-journal-text me-2 text-primary"></i> Assigned Subjects
        </a>
      </li>

      <li
        class="nav-item border-bottom"
        *ngIf="
          account.role === Role.Principal ||
          account.role === Role.Registrar ||
          account.role === Role.Teacher
        "
      >
        <a
          routerLink="/homeroom"
          routerLinkActive="active"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-house-door me-2 text-primary"></i> Homeroom Management
        </a>
      </li>

      <li
        class="nav-item border-bottom"
        *ngIf="account.role === Role.Registrar"
      >
        <a
          routerLink="/curriculum-subjects"
          routerLinkActive="active"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-book me-2 text-primary"></i> Subject Management
        </a>
      </li>

      <li
        class="nav-item border-bottom"
        *ngIf="account.role === Role.Registrar"
      >
        <a
          routerLink="/"
          routerLinkActive="active"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-calendar-check me-2 text-primary"></i> School Year
          Management
        </a>
      </li>

      <li class="nav-item border-bottom" *ngIf="account.role === Role.Student">
        <a
          routerLink="/egrade"
          routerLinkActive="active"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-bar-chart-line me-2 text-primary"></i> E-Grade
        </a>
      </li>

      <li class="nav-item border-bottom">
        <a
          routerLink="/profile"
          routerLinkActive="active"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-person-circle me-2 text-primary"></i> My Profile
        </a>
      </li>

      <li class="nav-item border-bottom">
        <a
          routerLink="/profile/modify"
          routerLinkActive="active"
          class="nav-link text-primary fw-semibold sidebar-link"
        >
          <i class="bi bi-gear me-2 text-primary"></i> Modify Account
        </a>
      </li>

      <li class="nav-item border-bottom">
        <a
          (click)="openLogoutModal()"
          class="nav-link text-primary fw-semibold sidebar-link"
          style="cursor: pointer"
        >
          <i class="bi bi-box-arrow-right me-2 text-primary"></i> Logout
        </a>
      </li>
    </ul>
  </nav>

  <div
    class="modal fade"
    tabindex="-1"
    [ngClass]="{ show: showLogoutModal }"
    [ngStyle]="{ display: showLogoutModal ? 'block' : 'none' }"
    role="dialog"
    aria-modal="true"
  >
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Confirm Logout</h3>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to logout?</p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="closeLogoutModal()"
          >
            No
          </button>
          <button type="button" class="btn btn-danger" (click)="logout()">
            Yes
          </button>
        </div>
      </div>
    </div>
  </div>
  <div
    class="modal-backdrop fade"
    [ngClass]="{ show: showLogoutModal }"
    *ngIf="showLogoutModal"
  ></div>

  <div
    class="flex-grow-1 background"
    style="padding: 1rem"
    [ngStyle]="
      !account
        ? {
            'background-image':
              'url(https://media.licdn.com/dms/image/v2/C561BAQEGwJUSWC5Dfw/company-background_10000/company-background_10000/0/1633699511389/benedicto_college_cover?e=2147483647&v=beta&t=Iiz-yGR2m0qFmUID-2wZehq_DmBizxAbccTxIoinYoc)',
            'background-size': 'cover',
            'background-position': 'center',
            'background-repeat': 'no-repeat'
          }
        : {
            'margin-top': '70px',
            'margin-left': '200px'
          }
    "
  >
    <router-outlet name="subnav"></router-outlet>

    <!-- global alert -->
    <div
      style="
        position: fixed;
        top: 80px; /* below the navbar */
        right: 20px;
        z-index: 1200; /* higher than navbar */
        width: auto;
        max-width: 400px;
      "
    >
      <alert></alert>
    </div>

    <!-- <breadcrumb-nav *ngIf="account" /> -->

    <!-- main router outlet -->
    <router-outlet></router-outlet>
  </div>
</div>
